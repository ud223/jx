<include file="Public/head"/>
<body class="no-skin">
<include file="Public/header"/>
<div class="main-container" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.check('main-container', 'fixed')
        } catch (e) {
        }
    </script>

    <include file="Public/sidebar"/>
    <div class="main-content">
        <div class="main-content-inner">
            <!-- #section:basics/content.breadcrumbs -->
            <include file="Public/breadcrumbs"/>

            <!-- /section:basics/content.breadcrumbs -->
            <div class="page-content">
                <include file="Public/set"/>

                <!-- /section:settings.box -->
                <div class="row">
                    <div class="col-xs-12">
                        <!-- PAGE CONTENT BEGINS -->
                        <form class="form-horizontal" role="form" id="form" method="post" action="{:U('update')}">
                            <input name="id" id="id" value="{$currentcategory.id}" type="hidden">


                            <div class="space-4"></div>
                            <div class="form-group">
                                <label class="col-sm-1 control-label no-padding-right" for="form-field-4">
                                    标题图 </label>
                                <div class="col-sm-9">
                                    <div class="col-xs-10 col-sm-5">
                                        {:UpImage("logo",100,100,$currentcategory['logo_photo']['img'])}
                                    </div>
                                    <span class="help-inline col-xs-12 col-sm-7">
                            <span class="middle">仅支持jpg、gif、png、bmp、jpeg，且小于1MB。（尺寸为1400*550px）</span>
                            </span>
                                </div>
                            </div>


                            <div class="space-4"></div>
                            <div class="form-group">
                                <label class="col-sm-1 control-label no-padding-right" for="name">活动标题</label>
                                <div class="col-sm-9">
                                    <input type="text" name="title" id="title" placeholder="请填写活动标题"
                                           class="col-xs-10 col-sm-5" value="{$currentcategory.title}">
                                    <span class="help-inline col-xs-12 col-sm-7">
                            <span class="middle">必填项</span>
                            </span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-1 control-label no-padding-right" for="form-field-0">
                                    活动状态： </label>
                                <div class="col-sm-9">
                                    <select id="active_state" name="active_state" class="col-xs-4 col-sm-4">
                                        <?php foreach ($active_state as $itm) :?>
                                        <?php if ($itm['id'] == $currentcategory['active_state']) :?>
                                        <option value="<?php echo $itm['id'] ?>" selected><?php echo $itm['name'] ?></option>
                                        <?php else :?>
                                        <option value="<?php echo $itm['id'] ?>"><?php echo $itm['name'] ?></option>
                                        <?php endif; ?>
                                        <?php endforeach; ?>
                                    </select>
                                    <span class="help-inline col-xs-12 col-sm-7">
                                        <span class="middle">注：如需要开启场次活动建议先选择已结束，添加场次活动完毕后，在修改成进行中！</span>
                            </span>
                                </div>
                            </div>

                            <div class="space-4"></div>
                            <div class="form-group">
                                <label class="col-sm-1 control-label no-padding-right" for="name">活动时间</label>
                                <div class="col-sm-9">
                                    <input type="text" name="time" id="time" placeholder="请填活动时间"
                                           class="col-xs-10 col-sm-5" value="{$currentcategory.time}">
                                    <span class="help-inline col-xs-12 col-sm-7">
                                        <span class="middle">请按照0000-00-00 00:00:00输入</span>
                            </span>
                                </div>
                            </div>

                            <div class="space-4"></div>
                            <div class="form-group">
                                <label class="col-sm-1 control-label no-padding-right" for="name">截止时间</label>
                                <div class="col-sm-9">
                                    <input type="text" name="deadline" id="deadline" placeholder="请填活动时间"
                                           class="col-xs-10 col-sm-5" value="{$currentcategory.deadline}">
                                    <span class="help-inline col-xs-12 col-sm-7">
                                        <span class="middle">请按照0000-00-00 00:00:00输入</span>
                            </span>
                                </div>
                            </div>

                            <div class="space-4"></div>
                            <div class="form-group">
                                <label class="col-sm-1 control-label no-padding-right" for="name"> 参加人数</label>
                                <div class="col-sm-9">
                                    <input type="text" name="limit_number" id="limit_number" placeholder="请填写参加人数"
                                           class="col-xs-10 col-sm-5" value="{$currentcategory.limit_number}">
                                    <span class="help-inline col-xs-12 col-sm-7">
                            <span class="middle">必填项</span>
                            </span>
                                </div>
                            </div>

                            <div class="space-4"></div>
                            <div class="form-group">
                                <label class="col-sm-1 control-label no-padding-right" for="name"> 已报名人数</label>
                                <div class="col-sm-9">
                                    <input type="text" name="participate_number" id="participate_number" placeholder="请填写参加人数"
                                           class="col-xs-10 col-sm-5" value="{$currentcategory.participate_number}">
                                    <span class="help-inline col-xs-12 col-sm-7">
                            <span class="middle">必填项</span>
                            </span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-1 control-label no-padding-right" for="form-field-0">
                                    积分条件： </label>
                                <div class="col-sm-9">
                                    <select id="integral_state" name="integral_state" class="col-xs-4 col-sm-4">
                                        <?php foreach ($integral_state as $itm) :?>
                                        <?php if ($itm['id'] == $currentcategory['integral_state']) :?>
                                        <option value="<?php echo $itm['id'] ?>" selected><?php echo $itm['name'] ?></option>
                                        <?php else :?>
                                        <option value="<?php echo $itm['id'] ?>"><?php echo $itm['name'] ?></option>
                                        <?php endif; ?>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                            </div>

                            <div class="space-4"></div>
                            <div class="form-group">
                                <label class="col-sm-1 control-label no-padding-right" for="name">积分</label>
                                <div class="col-sm-9">
                                    <input type="text" name="integral" id="integral" placeholder="请填写积分"
                                           class="col-xs-10 col-sm-5" value="{$currentcategory.integral}">
                                    <span class="help-inline col-xs-12 col-sm-7">
                            <span class="middle">必填项</span>
                            </span>
                                </div>
                            </div>

                            <div class="space-4"></div>
                            <div class="form-group">
                                <label class="col-sm-1 control-label no-padding-right" for="form-field-4">
                                    群二维码 </label>
                                <div class="col-sm-9">
                                    <div class="col-xs-10 col-sm-5">
                                        {:UpImage("group_pictures",100,100,$currentcategory['group_pictures'])}
                                    </div>
                                    <span class="help-inline col-xs-12 col-sm-7">
                            <span class="middle">仅支持jpg、gif、png、bmp、jpeg，且小于1MB。（尺寸为1400*550px）</span>
                            </span>
                                </div>
                            </div>

                            <div class="space-4"></div>
                            <div class="form-group">
                                <label class="col-sm-1 control-label no-padding-right" for="name">手机号</label>
                                <div class="col-sm-9">
                                    <input type="text" name="phone" id="phone" placeholder="请填写手机号"
                                           class="col-xs-10 col-sm-5" value="{$currentcategory.phone}">
                                    <span class="help-inline col-xs-12 col-sm-7">
                            <span class="middle">必填项</span>
                            </span>
                                </div>
                            </div>


                            <div class="space-4"></div>
                            <div class="form-group">
                                <label class="col-sm-1 control-label no-padding-right" for="form-field-2">
                                    活动内容 </label>
                                <div class="col-sm-9">
                                    <textarea name="introduce" id="introduce" style="width:100%;height:400px;visibility:hidden;">{$currentcategory['introduce']}</textarea>
                                </div>
                            </div>

                            <style>
                                .zt {
                                    color: red;
                                }

                                .mys_popfrm {
                                    width: 50%;
                                    left: 50%;
                                    margin-left: -25%;
                                    top: 30px;
                                    position: fixed;
                                    z-index: 12;
                                    background:#FFF;
                                    box-shadow: 0 10px 50px rgba(0,0,0,.5);
                                    border-radius:5px;
                                }
                                .mys_pop {
                                    display: none;
                                }
                                .mys_popfrm .inn .tt {
                                    font-weight: bold;
                                    margin-bottom:10px;
                                }
                                .mys_popfrm .r {

                                }
                                .mys_popfrm .inn {
                                    padding:15px;
                                }
                                .mys_popfrm .inn .r input {
                                    display: block;
                                    width:100%;
                                    box-sizing: border-box;
                                    height:36px;
                                    padding:0 15px;
                                    margin-bottom: 10px;
                                }

                                .mys_popfrm .inn .r button {
                                    display: block;
                                    width: 100%;
                                    box-sizing: border-box;
                                    padding:10px;
                                    border:none;
                                    background:#43B6A3;
                                    color:#FFF;
                                    border-radius: 3px;
                                    font-size: 16px;
                                }


                                .widhth{
                                    width: 70%;
                                    margin:30px
                                }

                                .hi{
                                    width: 200px;
                                }
                                .divcss5{ border:1px solid #aaaaaa; width:180px; height:25px

                                }
                                .divcss6{ border:1px solid #aaaaaa; width:180px; height:25px

                                }

                                .divcss4{ border:1px solid #aaaaaa; width:210px; height:34px

                                }
                                .div1{
                                    float:right;
                                }
                                .form-contro{
                                    width: 34% ;
                                }



                                .block_t_header {
                                    position:relative;
                                    padding:15px;
                                    font-size:16px;
                                    font-weight: bold;
                                    border-bottom:1px solid #ddd;
                                }
                                .cls_trl_btn {
                                    display:inline-block;
                                    width:40px;
                                    height:40px;
                                    text-align:center;
                                    line-height:40px;
                                    font-size:20px;
                                    right:10px;
                                    top:50%;
                                    margin-top:-20px;
                                    position: absolute;
                                    cursor: pointer;
                                }
                                .cls_trl_btn:hover {
                                    background:#eee;
                                }

                                .full_input_ctrl {
                                    width:100%;
                                }
                                .full_input_ctr {
                                    width:60%;
                                }

                                .adm_block_btn {
                                    width:100%;
                                    display:block;
                                    height:30px;
                                }
                                .adm_block_btn1 {
                                    width:50%;
                                    display:block;
                                    height:30px;
                                }

                                .value_set_tbl {
                                    width:100%;
                                    border-collapse: collapse;

                                }
                                .value_set_tbl .header_row {
                                    background:#333;
                                    color:#FFF;
                                }
                                .value_set_tbl td {
                                    padding:5px;
                                    border:1px solid #ddd;
                                }

                            </style>

                            <if condition="$currentcategory.id eq ''">
                                <div align="center">
                                    <strong>自定义报名表单</strong>
                                    <div id="diyige">
                                        <label class="zt">暂无报名表单（用户将直接报名成功） </label>
                                    </div>

                                    <div id="control"  class="widhth mys_pop">
                                        <table class="value_set_tbl" id="sssssss">
                                            <tr class="header_row">
                                                <td class="col1">表单标题</td>
                                                <td class="col2">控件类型</td>
                                                <td class="col3">是否必填</td>
                                                <td class="col3">是否唯一</td>
                                                <td class="col4">填充数据</td>
                                                <td class="col5">操作</td>
                                            </tr>
                                        </table>

                                    </div>
                                    <div>

                                    </div>
                                    <div>
                                        <button type="button" onclick="myclick()" >
                                            新增表单提交
                                        </button>
                                    </div>
                                </div>

                            </if>



                            <div >
                                <div class="mys_popfrm mys_pop"  id="fail"  >
                                    <div class="block_t_header">
                                        <span>表单详细设置</span>
                                        <span class="cls_trl_btn" onclick="$(this).closest('.mys_pop').hide();">&times;</span>
                                    </div>

                                    <div class="inn">

                                        <div class="tt">
                                            控件标题名称
                                        </div>

                                        <div class="tt">
                                            <input type="text" id="text" name="text" class="full_input_ctrl">
                                        </div>

                                        <div class="tt">
                                            控件类型
                                        </div>

                                        <div class="tt">
                                            <select name="field" id="field" class="ldr_slec full_input_ctrl" style="margin-bottom:5px;" >
                                                <volist name="activity_control" id="val">
                                                    <option value="{$val['id']}"  >{$val['name']}</option>
                                                </volist>
                                            </select>
                                        </div>

                                        <div class="tt">
                                            <input type="checkbox" name="not_for_province" id="not_for_province">  <label class="middle" for="not_for_province">必填项</label>
                                        </div>

                                        <div class="tt">
                                            <input type="checkbox" name="not_for_province3" id="not_for_province3">  <label class="middle" for="not_for_province">唯一项</label>
                                        </div>

                                        <button type="button" class="adm_block_btn" onclick="Choice()" >
                                            提交
                                        </button>

                                    </div>
                                </div>

                                <div class="mys_popfrm mys_pop"  id="success"  >
                                    <div class="block_t_header">
                                        <span>设置"输入框"数据</span>
                                        <span class="cls_trl_btn" onclick="$(this).closest('.mys_pop').hide();">&times;</span>
                                    </div>
                                    <div class="inn">

                                        <div class="tt">
                                            提示文字可选填
                                        </div>

                                        <div class="tt">
                                            <input type="text" id="optional" class="full_input_ctrl">
                                        </div>

                                        <button type="button"  class="adm_block_btn" onclick="slk()" >
                                            确定
                                        </button>
                                    </div>

                                </div>

                                <div class="mys_popfrm mys_pop"  id="model">
                                    <div class="block_t_header">
                                        <span> 设置"下拉框"数据</span>
                                        <span class="cls_trl_btn" onclick="$(this).closest('.mys_pop').hide();">&times;</span>
                                    </div>
                                    <div class="inn">

                                        <!--<div class="tt">-->
                                        <!--设置"下拉框"数据-->
                                        <!--</div>-->

                                        <div class="tt">
                                            <input type="text" id="selection" >

                                            <button type="button" onclick="add()">
                                                新增
                                            </button>

                                        </div>
                                        <div class="tt">
                                            已添加数据
                                        </div>

                                        <div id = "add"  style="margin-bottom:100px;">
                                        </div>

                                        <button type="button" onclick="ascertain()" class="adm_block_btn" >
                                            确定
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="mys_popfrm mys_pop" id="edit">
                                <div class="block_t_header">
                                    <span>表单详细设置</span>
                                    <span class="cls_trl_btn" onclick="$(this).closest('.mys_pop').hide();">&times;</span>
                                </div>
                                <div class="inn">
                                    <div class="tt">
                                        控件标题名称
                                    </div>

                                    <div class="tt">
                                        <input type="text" id="text1" name="text1" class="full_input_ctrl">
                                    </div>

                                    <div class="tt">
                                        控件类型
                                    </div>

                                    <div class="tt">
                                        <select name="field1" id="field1" class="ldr_slec full_input_ctrl" style="margin-bottom:5px;" >
                                            <volist name="activity_control" id="val">
                                                <option value="{$val['id']}"  >{$val['name']}</option>
                                            </volist>
                                        </select>
                                    </div>

                                    <div>
                                        <input type="checkbox" name="not_for_province1" id="not_for_province1">  <label class="middle" for="not_for_province">必填项</label>
                                    </div>

                                    <div>
                                        <input type="checkbox" name="not_for_province4" id="not_for_province4">  <label class="middle" for="not_for_province">唯一项</label>
                                    </div>

                                    <div class="tt">
                                        设置下拉框（多选框）内容
                                    </div>

                                    <div class="tt">
                                        <input type="text" id="selection1" class="full_input_ctr">

                                        <button type="button" onclick="add1()">
                                            新增
                                        </button>

                                    </div>

                                    <div class="tt">
                                        下拉框内容
                                    </div>

                                    <div class="tt" id="box"  style="margin-bottom:100px;">

                                    </div>

                                    <input type="hidden" id="json_id" name="json_id">

                                    <button type="button" class="adm_block_btn" onclick="repair()" >
                                        修改
                                    </button>


                                </div>
                            </div>
                            <input type="hidden" id="data_json" name="data_json">



                            <div class="col-md-offset-2 col-md-9">
                                <button class="btn btn-info submit" type="button" id="btn_submit">
                                    <i class="icon-ok bigger-110"></i>
                                    提交
                                </button>
                                &nbsp; &nbsp; &nbsp;
                                <button class="btn" type="reset">
                                    <i class="icon-undo bigger-110"></i>
                                    重置
                                </button>

                            </div>

                        </form>

                        <!-- PAGE CONTENT ENDS -->
                    </div><!-- /.col -->

                </div><!-- /.row -->

            </div><!-- /.page-content -->

        </div>
    </div><!-- /.main-content -->
    <include file="Public/footer"/>

</div><!-- /.main-container -->

</div>

<include file="Public/footerjs"/>
<!-- inline scripts related to this page -->
<script src="__PUBLIC__/qwadmin/js/date-time/bootstrap-datepicker.js"></script>
<script type="text/javascript">
    localStorage.setItem("name","caibin") //存储名字为name值为caibin的变量
    localStorage.name = "caibin"; // 等价于上面的命令

    $(function () {
        var editor = KindEditor.create('textarea[name="introduce"]', {
            uploadJson: '__PUBLIC__/kindeditor/php/upload_json.php',
            fileManagerJson: '__PUBLIC__/kindeditor/php/file_manager_json.php',
            allowFileManager: true,
            allowImageRemote: false,
            afterBlur: function () {
                this.sync();
            }
        });

        $(document).ready(function () {
            $('#btn_submit').click(function () {
                save()
            })
        });

        function save() {
            var id = $('#id').val();
            var data_json =  $("#data_json").val();
            var title = $("#title").val();
            var time = $("#time").val();
            var limit_number = $("#limit_number").val();
            var integral_state = $("#integral_state").val();
            var integral = $("#integral").val();
            var introduce = $("#introduce").val();
            var logo = $("#logo").val();
            var group_pictures = $("#group_pictures").val();
            var scene = $("#scene").val();
            var deadline = $("#deadline").val();
            var participate_number = $("#participate_number").val();
            var active_state = $("#active_state").val();
            var phone = $("#phone").val();

            var data = {};
            data.id = id;
            data.data_json = data_json;
            data.title = title;
            data.time = time;
            data.limit_number = limit_number;
            data.integral_state = integral_state;
            data.integral = integral;
            data.introduce = introduce;
            data.logo = logo;
            data.group_pictures = group_pictures;
            data.scene = scene;
            data.deadline = deadline;
            data.participate_number = participate_number;
            data.active_state = active_state;
            data.phone = phone;

            console.log(JSON.stringify(data));

            fit.ajax({
                url:'/Qwadmin/Activity/update',
                data:data,
                success:function(result){
                    //console.log(JSON.stringify(result));          // alert(JSON.stringify(result));
                    alert(result.msg);//发出信息
                    location.href = '/qwadmin/activity/index.html'
                }

            });
            alert('保存');
        }
    })

    //打开新增点击表单
    function myclick(){
        //清空控件数据
        document.getElementById("text").value="";
        document.getElementById("optional").value="";
        document.getElementById("field").value="0";
        $("#not_for_province").prop("checked",false);
        $("#not_for_province3").prop("checked",false);
        $('#add').html('');
        //打开新增页面
        document.getElementById("fail").style.display='block';

    }
    //下拉框判断进入指定页面
    function Choice(){
        //获取下拉框的id
        var  aid= $("#field").val();
        //进入文本框新增页面
        if(aid == 1 || aid == 2){
            document.getElementById("success").style.display='block';
            document.getElementById("fail").style.display="none";
        }
        //进入下拉框，复选框新增页面
        if( aid == 3 || aid == 4){
            document.getElementById("model").style.display='block';
            document.getElementById("fail").style.display="none";
        }
    }
    //json
    var form = [];
    //文本框新增
    function slk(){
        //是否必选
        var checked = document.getElementById("not_for_province");
        var checked1 = checked.checked;
        //必选为'1',选填为'0'
        if(checked1 == true){
            var checked12 ='1'
        }else{
            var checked12 ='0'
        }
        //是否唯一
        var checkedwy = document.getElementById("not_for_province3");
        var checkedwy1 = checkedwy.checked;
        //必选为'1',选填为'0'
        if(checkedwy1 == true){
            var checkedwy2 ='1'
        }else{
            var checkedwy2 ='0'
        }
        //新增文本框属性
        var control = {};

        control.code = Date.now().toString(36);//随机id
        control.checked = checked12;
        control.checkedwy = checkedwy2;
        control.title = $("#text").val();
        control.type = $("#field").val();
        control.sort = 1;
        control.length = 50;
        control.default =$("#optional").val();

        form.push(control);
        console.log(JSON.stringify(form));
        //点击保存后清空文本框新增页面数据
        document.getElementById("text").value="";
        document.getElementById("optional").value="";
        document.getElementById("field").value="0";
        $("#not_for_province").prop("checked",false);
        $("#not_for_province3").prop("checked",false);
        document.getElementById("success").style.display="none";

        var type_id = control.type;
        var title = control.title;
        var id = control.code;

        //判断显示在html的内容
        if(control.checked == 1){
            var checked3 = '是'
        }else{
            var checked3 = '否'
        }

        if(control.checkedwy == 1){
            var checkedwy3 = '是'
        }else{
            var checkedwy3 = '否'
        }

        if(type_id == 1){
            var name = '输入框';
        }

        if(type_id == 2){
            var name = '大输入框';
        }
        var formatItem ='  <tr class="itm_row" id='+id+'><td>'+title+'</td> <td>'+name+'</td> <td>'+checked3+'</td><td>'+checkedwy3+'</td> <td></td>  <td>  <button type="button"  onclick="modify(this)" id = '+id+'>修改</button> <button  type="button"  onclick="delete2(this)" id = '+id+'>删除</button> </td></tr>  '
        //显示内容
        $('#sssssss').append(formatItem);
        //解析成字符串，存进隐藏域！
        var str_pretty1 = JSON.stringify(form)
        $('#data_json').val(str_pretty1);
        //显示新增控件的数据
        document.getElementById("control").style.display='block';
        //隐藏div【暂无报名表单】！
        document.getElementById("diyige").style.display="none";

    }
    //新增下拉框，多选框
    function ascertain() {
        //是否必选
        var checked = document.getElementById("not_for_province");
        var checked1 = checked.checked;
        //必选为'1',选填为'0'
        if(checked1 == true){
            var checked12 ='1'
        }else{
            var checked12 ='0'
        }

        //是否唯一
        var checkedwy = document.getElementById("not_for_province3");
        var checkedwy1 = checkedwy.checked;
        //必选为'1',选填为'0'
        if(checkedwy1 == true){
            var checkedwy2 ='1'
        }else{
            var checkedwy2 ='0'
        }

        //遍历需要
        var arr = [];
        //存进下拉框内容
        var arr1 = [];
        //遍历class=divcss6的所有id
        $('.divcss6').each(function(){
            arr[i] = $(this).attr('id');
            arr1.push(arr[i]);//获取的id存进arr1
            i = i+1;
        })
        //存下拉框，多选框属性
        var control = {};
        control.checkedwy = checkedwy2;
        control.checked = checked12;
        control.code = Date.now().toString(36);
        control.title = $("#text").val();
        control.type = $("#field").val();
        control.sort = 1;
        control.length = 50;
        control.selection = arr1;

        form.push(control);
        console.log(JSON.stringify(form));
        //点击保存后清空下拉框，多选框新增页面数据
        document.getElementById("text").value="";
        document.getElementById("field").value="0";
        $("#not_for_province").prop("checked",false);
        $("#not_for_province3").prop("checked",false);
        $('#add').html('');

        //定义，用于显示
        var id = control.code;
        var type = control.type;
        var title = control.title;
        var select = control.selection;
        //解析成字符串，存进隐藏域
        var str_pretty1 = JSON.stringify(form)
        $('#data_json').val(str_pretty1);

        //判断
        if(type == 3){
            var name = '下拉框';
        }

        if(type == 4){
            var name = '多选框';
        }

        if(control.checked == 1){
            var checked3 = '是'
        }else{
            var checked3 = '否'
        }

        if(control.checkedwy == 1){
            var checkedwy3 = '是'
        }else{
            var checkedwy3 = '否'
        }

        var option = [];
        //循环显示下拉框，多选框新增的内容
        for ( var i = 0; i < select.length; i++){
            var www = select[i]
            //是否有值，无则不显示
            if(www){
                var optionse = www
                option.push(optionse)
            }
        }

        var formatItem =  '<tr class="itm_row" id='+id+'> <td>'+title+'</td> <td>'+name+'</td> <td>'+checked3+'</td><td>'+checkedwy3+'</td> <td> <div>'+option+'</div> </td> <td> <button type="button"  onclick="modify(this)" id = '+id+'>修改</button> <button type="button"  onclick="delete2(this)" id = '+id+'>删除</button> </td> </tr>'
        //显示内容
        $('#sssssss').append(formatItem);
        //关闭新增下拉框，多选框页面
        document.getElementById("model").style.display="none";
        //显示新增数据
        document.getElementById("control").style.display='block';
        //隐藏div【暂无报名表单】！
        document.getElementById("diyige").style.display="none";

    }
    //下拉框，多选框内容新增
    function add() {
        //获取内容
        var selection = $("#selection").val();


        //清空新增文本框内容
        document.getElementById("selection").value="";
        //显示新增内容
        var formatItem = '<div id="'+selection+'" class="divcss6">'+selection+'<div class="div1"><button type="button"  onclick="delete1(this)" id = '+selection+'>删除</button></div></div>' ;
        $('#add').append(formatItem);

    }
    //修改控件
    function modify(obj) {
        //获取控件id
        var id = obj.id;
        //清空修改页面的下拉款内容
        $('#box').html('');
        //根据id获取控件json
        var newArr = form.filter(function(control){
            return control.code === id ;
        });
        //获取下拉框选中的id
        var  xlk = document.getElementById('field1');
        //获取必选框的值
        var chk = document.getElementById('not_for_province1');

        //获取唯一框的值
        var chk1 = document.getElementById('not_for_province4');

        //通过for循环把的得到json显示在页面上
        for(var i=0;i<newArr.length;i++){
            var code =  newArr[i]['code'];
            var title =  newArr[i]['title'];
            var type =  newArr[i]['type'];
            var selection =  newArr[i]['selection'];
            var checked =  newArr[i]['checked'];
            console.log(checked);
            var checkedwy =  newArr[i]['checkedwy'];
            console.log(checkedwy);
            //json的code存进隐藏域
            $("#json_id").val(code);
            //显示json的其他数据
            $("#text1").val(title);

            if(checked == 1){
                var checked1 = 'true';
            }else{
                var checked1 = '';
            }
            console.log(checked1);
            if(checkedwy == 1){
                var checkedwy1 = 'true';
            }else{
                var checkedwy1 = '';
            }

            xlk[type].selected = true;

            chk.checked = checked1;
            chk1.checked = checkedwy1;
            //判断json.selection是否有数据！'下拉框，多选框数据'
            if(selection){
                for(var i=0;i<selection.length;i++){
                    var selection1 = selection[i];
                    if(selection1){
                        var formatItem = '<div class="divcss5" id="'+selection1+'">'+selection1+'<div class="div1"><button type="button"  onclick="delete1(this)" id = '+selection1+'>删除</button></div></div>' ;
                        $('#box').append(formatItem);
                    }
                }
            }
        }
        //打开修改页面
        document.getElementById("edit").style.display='block';
    }
    //点击修改
    function repair() {
        var arr = [];
        //获取class=divcss5的所有id
        var arr1 = [];

        $('.divcss5').each(function(){
            arr[i] = $(this).attr('id');
            arr1.push(arr[i]);
            i = i+1;
        })

        //获取输入的值
        var id = $("#json_id").val();
        var text1 = $("#text1").val();
        var field1 =  $("#field1").val();

        //移除原有的json
        $("#"+id+"").remove();

        //是否必选
        var checked = document.getElementById("not_for_province1");
        var checked1 = checked.checked;
        var checkedwy = document.getElementById("not_for_province4");
        var checkedwy1 = checkedwy.checked;
        console.log(checkedwy1);
        //必选为'1'选填为'0'
        if(checked1 == true){
            var checked12 ='1'
        }else{
            var checked12 ='0'
        }

        if(checkedwy1 == true){
            var checkedwy2 ='1'
        }else{
            var checkedwy2 ='0'
        }

        //查出需要修改的json
        var newArr = form.filter(function(control){
            return control.code === id ;
        });

        //console.log(newArr);
        //将修改页面的值来修改查出的json的数据
        for(var i=0;i<newArr.length;i++){

            //必选，'1'为是,'0'为否
            if(checked12== 1){
                var checked3 = '是'
            }else{
                var checked3 = '否'
            }

            if(checkedwy2== 1){
                var checkedwy3 = '是'
            }else{
                var checkedwy3 = '否'
            }

            //判断是否为输入框和大输入框
            if(field1 == 1 || field1 == 2 ){
                //修改json的值
                newArr[i]['title'] = text1;
                newArr[i]['code'] = id;
                newArr[i]['type'] = field1;
                newArr[i]['checked'] = checked12;
                newArr[i]['checkedwy'] = checkedwy2;
                newArr[i]['selection'] = arr1;

                //下拉框（多选框）修改成输入框，则删除下拉框（多选框）内容
                var surplus = newArr[i]['selection'];
                // console.log(newArr);
                if(surplus){
                    for ( var i = 0; i < surplus.length; i++)
                    {
                        delete surplus[i];
                    }
                }

                if(field1 == 1){
                    var name = '输入框';
                }

                if(field1 == 2){
                    var name = '大输入框';
                }

                var formatItem ='<tr class="itm_row" id='+id+'><td>'+text1+'</td> <td>'+name+'</td> <td>'+checked3+'</td> <td>'+checkedwy3+'</td><td></td>  <td>  <button type="button"  onclick="modify(this)" id = '+id+'>修改</button> <button  type="button"  onclick="delete2(this)" id = '+id+'>删除</button> </td></tr>'
                //将修改的值进行显示
                $('#sssssss').append(formatItem);

                //console.log(formatItem);
            }
            //判断是否为下拉框和多选框
            if(field1 == 3 ||field1 == 4){
                //修改json的值
                newArr[i]['title'] = text1;
                newArr[i]['code'] = id;
                newArr[i]['type'] = field1;
                newArr[i]['checked'] = checked12;
                newArr[i]['checkedwy'] = checkedwy2;
                newArr[i]['selection'] =arr1;

                if(field1 == 3){
                    var name = '下拉框';
                }

                if(field1 == 4){
                    var name = '多选框';
                }


                var option = [];
                //获取到的下拉框的值进行存储
                for ( var i = 0; i < arr1.length; i++){
                    var ddd = arr1[i]
                    //判断是否有值
                    if(ddd){
                        var optionse =  ddd;
                        option.push(optionse)
                    }
                }

                var formatItem =' <tr class="itm_row" id='+id+'><td>'+text1+'</td> <td>'+name+'</td> <td>'+checked3+'</td> <td>'+checkedwy3+'</td><td>'+option+'</td>  <td>  <button type="button"  onclick="modify(this)" id = '+id+'>修改</button> <button  type="button"  onclick="delete2(this)" id = '+id+'>删除</button> </td></tr>';

                $('#sssssss').append(formatItem);
            }
        }

        // console.log(control);
        //  解析成字符串进行存储
        var str_pretty1 = JSON.stringify(form)
        $('#data_json').val(str_pretty1);
        //关闭修改页面
        document.getElementById("edit").style.display="none";
    }
    //修改页面下拉框新增
    function add1() {
        //获取下拉框内容
        var selection = $("#selection1").val();
        //清空下拉框文本内容
        document.getElementById("selection1").value="";
        //显示修改页面
        var formatItem = '<div class="divcss5" id="'+selection+'">'+selection+'<div class="div1"><button type="button"  onclick="delete1(this)" id = '+selection+'>删除</button></div></div>' ;
        $('#box').append(formatItem);

    }
    //删除下拉框数据
    function delete1(obj) {
        var id = obj.id;
        $("#"+id+"").remove();

    }
    //删除控件
    function delete2(obj) {
        var id = obj.id;
        //移除显示的控件页面
        $("#"+id+"").remove();
        //查询需要删除的json
        var newArr = form.filter(function(control){
            return control.code === id ;
        });
        //删除json
        for(var i=0;i<newArr.length;i++){
            delete  newArr[i]['title']
            delete  newArr[i]['code']
            delete newArr[i]['type']
            delete  newArr[i]['checked']
            delete  newArr[i]['checkedwy']
            delete  newArr[i]['selection']
            delete  newArr[i]['sort']
            delete  newArr[i]['length']
            delete  newArr[i]['default']
        }
        //json解析存入隐藏域
        var str_pretty1 = JSON.stringify(form);
        $('#data_json').val(str_pretty1);
    }





</script>
</body>
</html>
